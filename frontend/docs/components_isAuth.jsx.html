<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/isAuth.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/isAuth.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use client";
import { useEffect, useState } from "react";
import { redirect, useRouter } from "next/navigation";
import Cookies from "universal-cookie";

/**
 * A higher-order component (HOC) that wraps a component and ensures authentication.
 *
 * @param {JSX.Element} Component - The React component to be wrapped.
 * @returns {Function} - A function that, when called, returns the wrapped component.
 */
export default function isAuth(Component) {
  /**
   * Wrapped component that ensures authentication before rendering.
   *
   * @component
   * @param {Object} props - The props passed to the wrapped component.
   * @returns {JSX.Element|null} - Returns the wrapped component if authenticated, otherwise null.
   */
  return function IsAuth(props) {
    const cookies = new Cookies();
    const router = useRouter();
    const auth = cookies.get("authenticated");
    const isLoggedIn = cookies.get("loggedIn");
    const [isSSR, setIsSSR] = useState(true);

    useEffect(() => { // fixes hydration warning
        setIsSSR(false);
    }, []);


    useEffect(() => {
      if ((!auth || auth === null) &amp;&amp; isLoggedIn) { // if not authenticated but logged in
        // Call logout endpoint and clear cookies
        fetch("http://localhost:8000/logout", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
        })
          .then((res) => { 
            if (res.status === 200) {
              // Successful logout
              cookies.set("authenticated", false, { path: '/' });
              cookies.set("researcherID", null, { path: '/' });
              cookies.set("firstName", null, { path: '/' });
              cookies.set("email", null, { path: '/' });
            } else {
                // Failed logout
                throw new Error("Failed to logout");
            }
          })
          .catch((err) => {
            console.error(err);
          }).finally(() => {
            router.push("/");
          });
      } else if ((!auth || auth === null) &amp;&amp; !isLoggedIn) { // if not authenticated and not logged in redirect to login page
        router.push("/");
      }
    }, []);


    if (!auth) {
      return null;
    }

    return (
        &lt;>
            {!isSSR &amp;&amp; &lt;Component {...props} suppressHydrationWarning={true} /> }
        &lt;/>
    );
  };
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AssessmentRow">AssessmentRow</a></li><li><a href="global.html#Assessments">Assessments</a></li><li><a href="global.html#CheckBox">CheckBox</a></li><li><a href="global.html#ConsentQuestion">ConsentQuestion</a></li><li><a href="global.html#CreateSurvey">CreateSurvey</a></li><li><a href="global.html#Dashboard">Dashboard</a></li><li><a href="global.html#DashboardRow">DashboardRow</a></li><li><a href="global.html#DuplicateSurvey">DuplicateSurvey</a></li><li><a href="global.html#EditSurvey">EditSurvey</a></li><li><a href="global.html#FreeResponse">FreeResponse</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#Modal">Modal</a></li><li><a href="global.html#MultipleChoice">MultipleChoice</a></li><li><a href="global.html#NavBar">NavBar</a></li><li><a href="global.html#Participant">Participant</a></li><li><a href="global.html#ParticipantRow">ParticipantRow</a></li><li><a href="global.html#Rating">Rating</a></li><li><a href="global.html#Register">Register</a></li><li><a href="global.html#StartAssessment">StartAssessment</a></li><li><a href="global.html#SurveyComponent">SurveyComponent</a></li><li><a href="global.html#SurveyRow">SurveyRow</a></li><li><a href="global.html#Surveys">Surveys</a></li><li><a href="global.html#Table">Table</a></li><li><a href="global.html#ViewSurvey">ViewSurvey</a></li><li><a href="global.html#fetcher">fetcher</a></li><li><a href="global.html#formatDate">formatDate</a></li><li><a href="global.html#formatQuestions">formatQuestions</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sat Dec 09 2023 19:01:21 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
